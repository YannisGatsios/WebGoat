### Ευπάθειες Κρίσιμης Σοβαρότητας

Αυτή η ενότητα περιγράφει λεπτομερώς κάθε μοναδική ευπάθεια κρίσιμης σοβαρότητας που εντοπίστηκε, παρέχοντας μια ολοκληρωμένη περιγραφή, σχετικές αναφορές CWE, τον επηρεαζόμενο κώδικα και εφαρμόσιμα βήματα αποκατάστασης.

#### 1. Επίλυση Εξωτερικής Οντότητας XML σε Δεδομένα Ελεγχόμενα από Χρήστη (XXE)

*   **Όνομα Ευπάθειας:** Επίλυση Εξωτερικής Οντότητας XML σε Δεδομένα Ελεγχόμενα από Χρήστη
*   **Επηρρεαζόμενο Αρχείο/Τοποθεσία:** `src/main/java/org/owasp/webgoat/lessons/xxe/CommentsCache.java:79`
*   **Περιγραφή:**
    Μια ευπάθεια XML External Entity (XXE) εμφανίζεται όταν ένας αναλυτής XML επεξεργάζεται μη αξιόπιστα δεδομένα XML με ενεργοποιημένο τον χειρισμό εξωτερικών οντοτήτων.[1, 2, 3, 4] Οι επιτιθέμενοι μπορούν να εκμεταλλευτούν αυτήν την αδυναμία για να συμπεριλάβουν εξωτερικό περιεχόμενο ή αναφορές εντός του XML, οδηγώντας σε διάφορες σοβαρές συνέπειες.
    *   **Αντίκτυπος:** Αυτός ο τύπος επίθεσης μπορεί να οδητώσει σε:
        *   **Αυθαίρετη Πρόσβαση σε Αρχεία:** Πρόσβαση σε ευαίσθητα αρχεία στο σύστημα (π.χ., `/etc/passwd`, πηγαίο κώδικα εφαρμογής) χρησιμοποιώντας URI `file://`.[1, 2, 3]
        *   **Άρνηση Υπηρεσίας (DoS):** Εξάντληση των πόρων του διακομιστή δημιουργώντας αναδρομικές ή υπερβολικά μεγάλες οντότητες (π.χ., επίθεση "billion laughs").[1, 2, 3, 4]
        *   **Server-Side Request Forgery (SSRF):** Αναγκάζοντας τον διακομιστή να κάνει αιτήματα σε εσωτερικούς ή εξωτερικούς πόρους, παρακάμπτοντας τα τείχη προστασίας και ενδεχομένως αποκτώντας πρόσβαση σε εσωτερικά δίκτυα ή μεταδεδομένα cloud.[1, 2, 3, 4]
        *   **Απομακρυσμένη Εκτέλεσης Κώδικα (RCE):** Σε ορισμένες διαμορφώσεις, η XXE μπορεί να αξιοποιηθεί για RCE.[3]
*   **Αναφορά CWE:**
    *   CWE-611: Improper Restriction of XML External Entity Reference [1, 2, 4, 5]
    *   CWE-776: Improper Restriction of Recursive Entity References in DTDs (XML Entity Expansion) [1, 5]
    *   CWE-827: Improper Control of Inbound Assumed-Immutable Data [1]
    *   Σημείωση: Η XXE ήταν μια ξεχωριστή κατηγορία (A4:2017) στο OWASP Top 10 2017, αλλά τώρα συνήθως κατηγοριοποιείται στην A05:2021 - Security Misconfiguration.[4]
*   **Απόσπασμα Επηρρεαζόμενου Κώδικα:**java
    76  .setProperty(XMLConstants.ACCESS_EXTERNAL_SCHEMA, "")); // compliant
    77 }
    78
    79 var xsr = xif.createXMLStreamReader(new StringReader(xml));
    ```
*   **Προτεινόμενη Αποκατάσταση:**
    *   **Απενεργοποίηση Επεξεργασίας DTD και Εξωτερικών Οντοτήτων:** Ο πιο αποτελεσματικός τρόπος πρόληψης επιθέσεων XXE είναι η πλήρης απενεργοποίηση της ανάλυσης των Δηλώσεων Τύπου Εγγράφου (DTDs) και των εξωτερικών οντοτήτων κατά την επεξεργασία μη αξιόπιστων δεδομένων XML.[1, 2, 4] Για τους αναλυτές Java (π.χ., `DocumentBuilderFactory`), θα πρέπει να οριστούν χαρακτηριστικά όπως το `http://apache.org/xml/features/disallow-doctype-decl` σε `true` και να απενεργοποιηθούν οι εξωτερικές γενικές και παραμετρικές οντότητες.[2] Ένα εννοιολογικό παράδειγμα ασφαλούς διαμόρφωσης είναι:
        ```java
        public void disableDTDParse(Socket sock) throws Exception {
            DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
            factory.setFeature("[http://apache.org/xml/features/disallow-doctype-decl](http://apache.org/xml/features/disallow-doctype-decl)", true); // GOOD
            // Other features to disable:
            // factory.setFeature("[http://xml.org/sax/features/external-general-entities](http://xml.org/sax/features/external-general-entities)", false);
            // factory.setFeature("[http://xml.org/sax/features/external-parameter-entities](http://xml.org/sax/features/external-parameter-entities)", false);
            DocumentBuilder builder = factory.newDocumentBuilder();
            builder.parse(sock.getInputStream());
        }
        ```
    *   **Χρήση Ασφαλών Αναλυτών/Βιβλιοθηκών XML:** Βεβαιωθείτε ότι η χρησιμοποιούμενη βιβλιοθήκη ανάλυσης XML είναι ενημερωμένη, καθώς οι νεότερες εκδόσεις συχνά απενεργοποιούν την επέκταση οντοτήτων από προεπιλογή ή παρέχουν σαφέστερες επιλογές ασφαλούς διαμόρφωσης.[1, 4]
    *   **Επικύρωση Εισόδου:** Αν και δεν αποτελεί πρωταρχική άμυνα έναντι της XXE, είναι πάντα σημαντικό να επικυρώνετε και να καθαρίζετε την είσοδο XML που παρέχεται από τον χρήστη για να μειώσετε την επιφάνεια επίθεσης.
*   **Προαιρετικά: Σενάριο Επαλήθευσης/Εκμετάλλευσης:**
    Εάν ο χρήστης κατάφερε να εκμεταλλευτεί αυτήν την ευπάθεια (π.χ., να διαβάσει ένα τοπικό αρχείο όπως το `/etc/passwd` ή να προκαλέσει ένα SSRF), θα πρέπει να συμπεριλάβει στιγμιότυπα οθόνης της εκμετάλλευσης και μια λεπτομερή περιγραφή των βημάτων που ακολουθήθηκαν.

Η ικανότητα της XXE να λειτουργεί ως "σημείο αναφοράς" ή "εκτόξευσης" για άλλες επιθέσεις υποδηλώνει την κρίσιμη φύση της. Πολλαπλά δεδομένα υπογραμμίζουν ότι οι ευπάθειες XXE μπορούν να οδηγήσουν άμεσα σε άλλες σοβαρές επιθέσεις, όπως SSRF, DoS και διαρροή δεδομένων.[1, 2, 3, 4] Μια ενιαία ευπάθεια XXE, εάν εκμεταλλευτεί, μπορεί να κλιμακωθεί σε μια πολύ ευρύτερη παραβίαση, επιτρέποντας στους επιτιθέμενους να παρακάμψουν τους ελέγχους δικτύου (τείχη προστασίας), να αποκτήσουν πρόσβαση σε εσωτερικά συστήματα και να διαρρεύσουν ευαίσθητα δεδομένα. Η κατανόηση αυτού του μηχανισμού αλυσιδωτής αντίδρασης είναι ζωτικής σημασίας για την ολοκληρωμένη ανάλυση ασφαλείας, καθώς καταδεικνύει ότι ο πραγματικός αντίκτυπος μιας ευπάθειας συχνά εκτείνεται πέρα από την άμεση εκδήλωσή της.

#### 2. Αποσειριοποίηση Δεδομένων Ελεγχόμενων από Χρήστη (Μη Ασφαλής Αποσειριοποίηση)

*   **Όνομα Ευπάθειας:** Αποσειριοποίηση Δεδομένων Ελεγχόμενων από Χρήστη
*   **Επηρρεαζόμενο Αρχείο/Τοποθεσία:**
    *   `src/main/java/org/owasp/webgoat/lessons/vulnerablecomponents/VulnerableComponentsLesson.java:42`
    *   `src/main/java/org/owasp/webgoat/lessons/deserialization/InsecureDeserializationTask.java:45`
*   **Περιγραφή:**
    Η μη ασφαλής αποσειριοποίηση συμβαίνει όταν μια εφαρμογή αποσειριοποιεί μη αξιόπιστα δεδομένα χωρίς επαρκή επικύρωση.[6, 7, 8] Η σειριοποίηση μετατρέπει ένα αντικείμενο σε μια μορφή για αποθήκευση ή μετάδοση, και η αποσειριοποίηση αντιστρέφει αυτή τη διαδικασία. Όταν κακόβουλα σειριοποιημένα δεδομένα αποσειριοποιούνται, μπορούν να χρησιμοποιηθούν για την εκτέλεση αυθαίρετου κώδικα, τον χειρισμό αντικειμένων ή την εκτέλεση επιθέσεων injection.
    *   **Αντίκτυπος:** Αυτή η ευπάθεια μπορεί να οδηγήσει σε:
        *   **Απομακρυσμένη Εκτέλεση Κώδικα (RCE):** Οι επιτιθέμενοι μπορούν να δημιουργήσουν κακόβουλα σειριοποιημένα αντικείμενα που εκτελούν αυθαίρετο κώδικα στον διακομιστή κατά την αποσειριοποίηση.[6, 7, 8]
        *   **Άρνηση Υπηρεσίας (DoS):** Η υποβολή μεγάλων ή πολύπλοκων σειριοποιημένων αντικειμένων μπορεί να εξαντλήσει τους πόρους του διακομιστή, οδηγώντας σε DoS.[6, 7, 8]
        *   **Αύξηση Προνομίων:** Εάν το αποσειριοποιημένο αντικείμενο έχει περισσότερα προνόμια από τον επιτιθέμενο, μπορεί να οδηγήσει σε αύξηση προνομίων.[6]
        *   **Παραποίηση/Χειρισμός Δεδομένων:** Αλλαγή της λογικής ή της κατάστασης της εφαρμογής.[6, 7]
*   **Αναφορά CWE:**
    *   CWE-502: Deserialization of Untrusted Data [5, 6, 7, 8]
    *   OWASP Top 10 A8:2017 - Insecure Deserialization.[6, 8] Στο OWASP Top 10 2021, εμπίπτει στην A05:2021 - Security Misconfiguration ή A08:2021 - Software and Data Integrity Failures.[5]
*   **Απόσπασμα Επηρρεαζόμενου Κώδικα:**
    *   Για `VulnerableComponentsLesson.java:42`:
        ```java
        39  .replace(">", ""));
        40  .replace("<", ""));
        41 }
        42 Contact c = (Contact) xstream.fromXML(payload);
        ```
    *   Για `InsecureDeserializationTask.java:45`:
        ```java
        42 try (ObjectInputStream ois =
        43     new ObjectInputStream(new ByteArrayInputStream(Base64.getDecoder().decode(b64token)))) {
        44     before = System.currentTimeMillis();
        45     Object o = ois.readObject();
        ```
*   **Προτεινόμενη Αποκατάσταση:**
    *   **Αποφυγή Αποσειριοποίησης Μη Αξιόπιστων Δεδομένων:** Η πιο ασφαλής προσέγγιση είναι να αποφεύγεται εντελώς η αποσειριοποίηση αντικειμένων από μη αξιόπιστες πηγές.[6, 7, 8]
    *   **Έλεγχοι Ακεραιότητας:** Εάν η αποσειριοποίηση από μη αξιόπιστες πηγές είναι αναπόφευκτη, διασφαλίστε την ακεραιότητα των σειριοποιημένων δεδομένων χρησιμοποιώντας ψηφιακές υπογραφές ή HMACs.[6, 7, 8]
    *   **Αυστηροί Περιορισμοί Τύπων (Whitelisting):** Επιβάλλετε αυστηρούς περιορισμούς τύπων κατά την αποσειριοποίηση. Επιτρέψτε την αποσειριοποίηση μόνο ενός περιορισμένου συνόλου αναμενόμενων και ασφαλών κλάσεων. Αυτό μπορεί να γίνει παρακάμπτοντας το `ObjectInputStream.resolveClass()` στην Java.[7, 8]
    *   **Απομόνωση Κώδικα:** Εκτελέστε τον κώδικα αποσειριοποίησης σε ένα απομονωμένο περιβάλλον (π.χ., ξεχωριστή διεργασία, sandbox) για να περιορίσετε τον αντίκτυπο πιθανής εκτέλεσης κακόβουλου κώδικα.[6]
    *   **Παρακολούθηση και Καταγραφή:** Καταγράψτε τυχόν εξαιρέσεις που προκύπτουν κατά την αποσειριοποίηση και παρακολουθήστε για μη φυσιολογική χρήση πόρων (μνήμη, CPU, σύστημα αρχείων, δίκτυο).[6]
    *   **Χρήση Απλούστερων Μορφών Δεδομένων:** Προτιμήστε λιγότερο πολύπλοκες μορφές δεδομένων όπως JSON ή XML για την ανταλλαγή δεδομένων, καθώς είναι γενικά λιγότερο επιρρεπείς σε ευπάθειες αποσειριοποίησης σε σύγκριση με τις εγγενείς μορφές σειριοποίησης αντικειμένων.[6, 8]
    *   **Διατήρηση Ενημερωμένων Συστημάτων:** Ενημερώνετε τακτικά τις βιβλιοθήκες και τα πλαίσια για να επιδιορθώσετε γνωστές ευπάθειες αποσειριοποίησης.[6]
*   **Προαιρετικά: Σενάριο Επαλήθευσης/Εκμετάλλευσης:**
    Εάν ο χρήστης κατάφερε να εκμεταλλευτεί αυτήν την ευπάθεια (π.χ., να επιτύχει RCE), θα πρέπει να συμπεριλάβει στιγμιότυπα οθόνης και μια λεπτομερή περιγραφή του payload και της ροής εκτέλεσης.

Η επανεμφάνιση του ίδιου τύπου κρίσιμης ευπάθειας, όπως φαίνεται στα δύο ευρήματα "Deserialization of user-controlled data", υποδηλώνει ένα συστημικό ζήτημα εντός του σχεδιασμού του WebGoat ή μια κοινή μη ασφαλή πρακτική κωδικοποίησης που σχετίζεται με την αποσειριοποίηση. Αυτό σημαίνει ότι η εφαρμογή ενδέχεται να χρησιμοποιεί ένα ευάλωτο μοτίβο αποσειριοποίησης ή βιβλιοθήκη σε πολλαπλά σημεία, ή ότι στερείται ενός κεντρικού, ασφαλούς μηχανισμού αποσειριοποίησης. Για τον εκπαιδευόμενο, αυτό υπογραμμίζει τη σημασία του εντοπισμού των υποκείμενων αρχιτεκτονικών ελαττωμάτων ή κοινών αντι-μοτίβων, αντί απλώς της επιδιόρθωσης μεμονωμένων περιπτώσεων. Μια ολιστική αναθεώρηση του τρόπου χειρισμού της αποσειριοποίησης σε ολόκληρη την εφαρμογή θα ήταν πιο αποτελεσματική από την αντιμετώπιση κάθε ευρήματος μεμονωμένα.

#### 3. Παραποίηση Αιτήματος από την Πλευρά του Διακομιστή (SSRF)

*   **Όνομα Ευπάθειας:** Παραποίηση Αιτήματος από την Πλευρά του Διακομιστή (SSRF)
*   **Επηρρεαζόμενο Αρχείο/Τοποθεσία:** `src/main/java/org/owasp/webgoat/lessons/ssrf/SSRFTask2.java:36`
*   **Περιγραφή:**
    Η παραποίηση αιτήματος από την πλευρά του διακομιστή (SSRF) επιτρέπει σε έναν επιτιθέμενο να εκμεταλλευτεί τη λειτουργικότητα του διακομιστή για να διαβάσει ή να ενημερώσει εσωτερικούς πόρους.[9, 10] Αυτό συμβαίνει όταν μια εφαρμογή ανακτά έναν απομακρυσμένο πόρο με βάση ένα URL που παρέχεται από τον χρήστη χωρίς την κατάλληλη επικύρωση.
    *   **Αντίκτυπος:** Οι επιτιθέμενοι μπορούν να χειραγωγήσουν τον διακομιστή για να:
        *   **Πρόσβαση σε Εσωτερικά Δίκτυα:** Παράκαμψη τειχών προστασίας για αλληλεπίδραση με εσωτερικές υπηρεσίες (π.χ., βάσεις δεδομένων, εσωτερικές διεπαφές REST, υπηρεσίες μεταδεδομένων cloud όπως AWS `http://169.254.169.254/`).[9, 10]
        *   **Ανάγνωση Τοπικών Αρχείων:** Πρόσβαση σε αρχεία στο σύστημα αρχείων του διακομιστή χρησιμοποιώντας URI `file://`.[9, 11]
        *   **Σάρωση Θυρών:** Χρησιμοποιήστε τον διακομιστή ως proxy για τη σάρωση εσωτερικών δικτύων για ανοιχτές θύρες και υπηρεσίες.[11]
        *   **Εκτέλεση Μη Εξουσιοδοτημένων Εντολών:** Σε ορισμένες περιπτώσεις, το SSRF μπορεί να οδηγήσει σε εκτέλεση εντολών ή διαρροή δεδομένων.[10, 11]
*   **Αναφορά CWE:**
    *   CWE-918: Server-Side Request Forgery (SSRF) [10, 11, 12]
    *   OWASP Top 10 A10:2021 - Server-Side Request Forgery (SSRF) [12]
*   **Απόσπασμα Επηρρεαζόμενου Κώδικα:**
    ```java
    33 protected AttackResult furBall(String url) {
    34     if (url.matches("[http://ifconfig.pro](http://ifconfig.pro)")) {
    35         String html;
    36         try (InputStream in = new URL(url).openStream()) {
    ```
*   **Προτεινόμενη Αποκατάσταση:**
    *   **Επικύρωση Εισόδου και Λίστες Επιτρεπόμενων (Whitelisting):** Επικυρώνετε αυστηρά τα URL που παρέχονται από τον χρήστη. Η πιο ασφαλής προσέγγιση είναι να επιτρέπετε μόνο συγκεκριμένους τομείς, διευθύνσεις IP και πρωτόκολλα. Αποφύγετε τη χρήση λιστών αποκλεισμού, καθώς είναι ευκολότερο να παρακαμφθούν.[9, 10]
    *   **Περιορισμός Σχημάτων URL:** Επιτρέψτε μόνο τα απαραίτητα σχήματα URL (π.χ., `http`, `https`). Απαγορεύστε σχήματα όπως `file://`, `gopher://`, `ftp://`.
    *   **Απενεργοποίηση Ανακατευθύνσεων HTTP:** Διαμορφώστε τον πελάτη HTTP ώστε να μην ακολουθεί αυτόματα ανακατευθύνσεις, καθώς αυτές μπορούν να χρησιμοποιηθούν για την παράκαμψη της επικύρωσης και την ανακατεύθυνση σε εσωτερικούς πόρους.[10]
    *   **Περιορισμός Μεθόδων HTTP:** Περιορίστε τις μεθόδους HTTP που χρησιμοποιούνται για αιτήματα από την πλευρά του διακομιστή μόνο σε αυτές που είναι απαραίτητες (π.χ., `GET`), μειώνοντας τον κίνδυνο ακούσιων παρενεργειών από κακόβουλα αιτήματα.[10]
    *   **Διαχωρισμός Δικτύου:** Εφαρμόστε ισχυρούς κανόνες διαχωρισμού δικτύου και τείχους προστασίας για να περιορίσετε την ικανότητα του διακομιστή να συνδεθεί με εσωτερικούς πόρους, ακόμη και αν εκμεταλλευτεί ένα SSRF.
*   **Προαιρετικά: Σενάριο Επαλήθευσης/Εκμετάλλευσης:**
    Εάν ο χρήστης κατάφερε να εκμεταλλευτεί αυτήν την ευπάθεια (π.χ., να αποκτήσει πρόσβαση σε μια εσωτερική υπηρεσία ή ένα τοπικό αρχείο), θα πρέπει να συμπεριλάβει στιγμιότυπα οθόνης και μια λεπτομερή περιγραφή του κατασκευασμένου URL και του παρατηρούμενου αποτελέσματος.

Ενώ το SSRF ταξινομείται ως ευπάθεια "Υψηλής" σοβαρότητας, συχνά αποτελεί ένα κρίσιμο βήμα σε επιθέσεις πολλαπλών σταδίων. Πολλαπλά δεδομένα υπογραμμίζουν επανειλημμένα την ικανότητα του SSRF να αποκτά πρόσβαση σε εσωτερικά δίκτυα, να παρακάμπτει τείχη προστασίας και να αλληλεπιδρά με υπηρεσίες που δεν εκτίθενται απευθείας στο διαδίκτυο.[9, 10, 11] Αυτό επιτρέπει σε έναν επιτιθέμενο να χρησιμοποιήσει τον ευάλωτο διακομιστή ως proxy για να παρακάμψει τις περιμετρικές άμυνες και να αποκτήσει μη εξουσιοδοτημένη πρόσβαση σε εσωτερικά συστήματα, μεταδεδομένα cloud ή ευαίσθητα αρχεία που διαφορετικά θα ήταν απρόσιτα. Για τον εκπαιδευόμενο, αυτό αναδεικνύει ότι ο πραγματικός αντίκτυπος μιας ευπάθειας μπορεί να ενισχυθεί σημαντικά όταν συνδυάζεται με άλλες τεχνικές, μετατρέποντας μια "Υψηλή" σοβαρότητα σε ένα κρίσιμο συστατικό μιας ευρύτερης παραβίασης.

---

### Ευπάθειες Υψηλής Σοβαρότητας

Αυτή η ενότητα περιγράφει λεπτομερώς τουλάχιστον τρεις μοναδικές ευπάθειες υψηλής σοβαρότητας, παρέχοντας μια ολοκληρωμένη περιγραφή, σχετικές αναφορές CWE, τον επηρεαζόμενο κώδικα και εφαρμόσιμα βήματα αποκατάστασης.

#### 1. Μη Ελεγχόμενα Δεδομένα που Χρησιμοποιούνται σε Έκφραση Διαδρομής (Path Traversal)

*   **Όνομα Ευπάθειας:** Μη Ελεγχόμενα Δεδομένα που Χρησιμοποιούνται σε Έκφραση Διαδρομής
*   **Επηρρεαζόμενο Αρχείο/Τοποθεσία:** `src/main/java/org/owasp/webgoat/webwolf/FileServer.java:77`
*   **Περιγραφή:**
    Αυτή η ευπάθεια, γνωστή και ως Path Traversal ή Directory Traversal (CWE-22), εμφανίζεται όταν μια εφαρμογή χρησιμοποιεί είσοδο που ελέγχεται από τον χρήστη για να κατασκευάσει μια διαδρομή αρχείου χωρίς την κατάλληλη εξουδετέρωση ειδικών στοιχείων όπως ".." ή απόλυτες ακολουθίες διαδρομών.[13, 14, 15, 16, 17, 18, 19] Αυτό επιτρέπει σε έναν επιτιθέμενο να αποκτήσει πρόσβαση σε απρόβλεπτα αρχεία ή καταλόγους στο υποκείμενο σύστημα αρχείων.
    *   **Αντίκτυπος:** Οι επιτιθέμενοι μπορούν να το εκμεταλλευτούν για να:
        *   **Ανάγνωση Ευαίσθητων Δεδομένων ή Αρχείων:** Πρόσβαση σε ευαίσθητα αρχεία όπως `/etc/passwd`, αρχεία διαμόρφωσης ή άλλες εμπιστευτικές πληροφορίες.[13, 14, 18, 19]
        *   **Εγγραφή Αυθαίρετων Αρχείων:** Εγγραφή αρχείων σε μη αναμενόμενες τοποθεσίες, οδηγώντας ενδεχομένως σε αντικατάσταση αρχείων εφαρμογών, μεταφόρτωση web shells ή άρνηση υπηρεσίας μέσω αντικατάστασης κρίσιμων αρχείων συστήματος.[14, 19]
        *   **Μη Εξουσιοδοτημένη Πρόσβαση:** Απόκτηση μη εξουσιοδοτημένης πρόσβασης στο σύστημα αρχείων.[15, 19]
        *   **Επηρεασμός Συμπεριφοράς Εφαρμογής:** Τροποποίηση της συμπεριφοράς της εφαρμογής μέσω της τροποποίησης απρόβλεπτων αρχείων.[13]
*   **Αναφορά CWE:**
    *   CWE-22: Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal') [14, 15]
    *   CWE-23: Relative Path Traversal [16, 20]
    *   CWE-36: Absolute Path Traversal [17, 21]
    *   CWE-73: External Control of File Name or Path [18, 19]
    *   OWASP Category: A01:2021 - Broken Access Control [22]
*   **Απόσπασμα Επηρρεαζόμενου Κώδικα:**
    ```java
    74    try (InputStream is = multipartFile.getInputStream()) {
    75        var destinationFile = destinationDir.toPath().resolve(multipartFile.getOriginalFilename());
    76        Files.deleteIfExists(destinationFile);
    77        Files.copy(is, destinationFile);
    ```
*   **Προτεινόμενη Αποκατάσταση:**
    *   **Επικύρωση Εισόδου (Whitelisting):** Επικυρώνετε αυστηρά την είσοδο του χρήστη πριν τη χρησιμοποιήσετε για την κατασκευή διαδρομών αρχείων. Η ασφαλέστερη προσέγγιση είναι να χρησιμοποιείτε μια λίστα επιτρεπόμενων (allow-list) ασφαλών μοτίβων ή να ελέγχετε ότι το όνομα αρχείου δεν περιέχει διαχωριστικά διαδρομών (`/`, `\`) ή αναφορές γονικού καταλόγου (`..`).[13, 18, 19, 23] Η απλή αφαίρεση ακολουθιών `../` δεν είναι επαρκής.[13]
    *   **Έμμεσες Αναφορές:** Εάν το σύνολο των αποδεκτών ονομάτων αρχείων είναι γνωστό, χρησιμοποιήστε έμμεσες αναφορές αντικειμένων (π.χ., αριθμητικά αναγνωριστικά) αντί να δέχεστε απευθείας ονόματα αρχείων από τον χρήστη. Ο διακομιστής αντιστοιχίζει αυτά τα αναγνωριστικά σε πραγματικά ονόματα αρχείων, διασφαλίζοντας ότι προσπελάζονται μόνο εγκεκριμένα αρχεία.[15, 18, 19]
    *   **Κανονικοποίηση Διαδρομής και Περιορισμός:** Επιλύστε τη διαδρομή που παρέχεται από τον χρήστη σε σχέση με έναν ασφαλή βασικό κατάλογο και, στη συνέχεια, επαληθεύστε ότι η προκύπτουσα κανονικοποιημένη διαδρομή παραμένει εντός αυτού του ασφαλούς καταλόγου. Αυτό αφαιρεί συμβολικό περιεχόμενο όπως ακολουθίες `../`.[13, 14]
    *   **Ελάχιστο Προνόμιο:** Διαμορφώστε την πρόσβαση στο σύστημα αρχείων με βάση την αρχή του ελάχιστου προνομίου για να ελαχιστοποιήσετε τον αντίκτυπο των επιτυχημένων επιθέσεων.[15]
    *   **Επικύρωση από την Πλευρά του Διακομιστή:** Η επικύρωση από την πλευρά του πελάτη παρακάμπτεται εύκολα. Πάντα να εφαρμόζετε επικύρωση από την πλευρά του διακομιστή.[18]
*   **Προαιρετικά: Σενάριο Επαλήθευσης/Εκμετάλλευσης:**
    Εάν ο χρήστης κατάφερε να εκμεταλλευτεί αυτήν την ευπάθεια (π.χ., να διαβάσει ένα αρχείο εκτός του προβλεπόμενου καταλόγου), θα πρέπει να συμπεριλάβει στιγμιότυπα οθόνης και μια λεπτομερή περιγραφή της κατασκευασμένης διαδρομής και του παρατηρούμενου αποτελέσματος.

Η ευπάθεια "Uncontrolled data used in path expression" είναι κρίσιμη επειδή επιτρέπει στους επιτιθέμενους να χειραγωγήσουν τις διαδρομές αρχείων, οδηγώντας σε μη εξουσιοδοτημένη πρόσβαση σε ευαίσθητα δεδομένα, αντικατάσταση κρίσιμων αρχείων ή ακόμα και εκτέλεση αυθαίρετου κώδικα.[14, 19] Η ικανότητα να διαβάζει ή να γράφει αρχεία εκτός των προβλεπόμενων ορίων μπορεί να οδηγήσει σε πλήρη παραβίαση του συστήματος. Για τον εκπαιδευόμενο, αυτό υπογραμμίζει τη σημασία της αυστηρής επικύρωσης της εισόδου και της χρήσης ασφαλών API χειρισμού διαδρομών για την πρόληψη τέτοιων επιθέσεων, καθώς και την κατανόηση του πώς μια φαινομενικά απλή αδυναμία μπορεί να έχει σοβαρές συνέπειες για την ασφάλεια.

#### 2. Μη Ασφαλής Τυχαιότητα

*   **Όνομα Ευπάθειας:** Μη Ασφαλής Τυχαιότητα
*   **Επηρρεαζόμενο Αρχείο/Τοποθεσία:** `src/main/java/org/owasp/webgoat/lessons/jwt/JWTRefreshEndpoint.java:77`
*   **Περιγραφή:**
    Η μη ασφαλής τυχαιότητα εμφανίζεται όταν μια εφαρμογή χρησιμοποιεί μια προβλέψιμη ψευδο-τυχαία γεννήτρια αριθμών (PRNG) σε ένα ευαίσθητο στην ασφάλεια πλαίσιο.[24, 25] Οι τυπικές PRNG είναι ντετερμινιστικές και η έξοδός τους μπορεί να προβλεφθεί εάν ο σπόρος ή λίγες αρχικές τιμές είναι γνωστοί, καθιστώντας τις ακατάλληλες για κρυπτογραφικούς σκοπούς.
    *   **Αντίκτυπος:** Εάν οι τυχαίοι αριθμοί είναι προβλέψιμοι, οι επιτιθέμενοι μπορούν να:
        *   **Παραβιάσουν Κρυπτογραφικά Κλειδιά/Παραμέτρους Ασφαλείας:** Προβλέψουν τιμές που χρησιμοποιούνται για αναγνωριστικά συνεδρίας, tokens, επαναφορές κωδικών πρόσβασης ή κλειδιά κρυπτογράφησης.[24, 25]
        *   **Εκτελέσουν Επιθέσεις Brute-Force/Μαντεψιάς:** Μαντέψουν εύκολα τις παραγόμενες τιμές, οδηγώντας σε μη εξουσιοδοτημένη πρόσβαση, υποκλοπή συνεδρίας ή επιθέσεις επανάληψης.[24, 25]
        *   **Αποκτήσουν Άδικο Πλεονέκτημα:** Σε εφαρμογές όπως τυχερά παιχνίδια ή λαχεία, η προβλέψιμη τυχαιότητα μπορεί να εκμεταλλευτεί για άδικα κέρδη.[26]
*   **Αναφορά CWE:**
    *   CWE-330: Use of Insufficiently Random Values
    *   CWE-338: Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG) [5, 25, 27]
    *   OWASP A02:2021 - Cryptographic Failures [5]
*   **Απόσπασμα Επηρρεαζόμενου Κώδικα:**
    ```java
    74      .compact();
    75 Map<String, Object> tokenJson = new HashMap<>();
    76 String refreshToken = RandomStringUtils.randomAlphabetic(20);
    77 validRefreshTokens.add(refreshToken);
    ```
*   **Προτεινόμενη Αποκατάσταση:**
    *   **Χρήση Κρυπτογραφικά Ασφαλών PRNGs:** Πάντα να χρησιμοποιείτε κρυπτογραφικά ισχυρές ψευδο-τυχαίες γεννήτριες αριθμών (CSPRNGs) για ευαίσθητα στην ασφάλεια πλαίσια. Στην Java, θα πρέπει να χρησιμοποιείται η `java.security.SecureRandom`.[24] Ένα εννοιολογικό παράδειγμα ασφαλούς κώδικα είναι:
        ```java
        public static int generateRandom(int maximumValue) {
            SecureRandom ranGen = new SecureRandom(); // GOOD: Cryptographically strong PRNG
            return ranGen.nextInt(maximumValue);
        }
        ```
    *   **Αποφυγή Προβλέψιμων Σπόρων:** Βεβαιωθείτε ότι ο σπόρος για οποιαδήποτε PRNG είναι πραγματικά απρόβλεπτος και δεν βασίζεται σε εύκολα μαντέψιμες τιμές όπως η ώρα του συστήματος.[24, 25]
    *   **Τακτική Ενημέρωση Λογισμικού:** Διατηρείτε τις βιβλιοθήκες και τα πλαίσια ενημερωμένα για να διασφαλίσετε ότι χρησιμοποιούν ασφαλείς μηχανισμούς δημιουργίας τυχαίων αριθμών.[25]
*   **Προαιρετικά: Σενάριο Επαλήθευσης/Εκμετάλλευσης:**
    Εάν ο χρήστης κατάφερε να αποδείξει την προβλεψιμότητα (π.χ., προβλέποντας ένα refresh token), θα πρέπει να συμπεριλάβει στιγμιότυπα οθόνης και μια περιγραφή της μεθοδολογίας.

Η εύρεση της "Μη ασφαλούς τυχαιότητας" ειδικά στο `JWTRefreshEndpoint.java` αναδεικνύει σημαντικά τον πρακτικό της αντίκτυπο. Η προβλεψιμότητα των τυχαίων αριθμών σε αυτό το πλαίσιο θα μπορούσε να οδηγήσει σε προβλέψιμα tokens ανανέωσης JWT, καθιστώντας ευκολότερο για έναν επιτιθέμενο να μαντέψει έγκυρα tokens, να υποκλέψει συνεδρίες χρηστών ή να εκτελέσει επιθέσεις επανάληψης. Αυτό καταδεικνύει ότι η σοβαρότητα μιας ευπάθειας δεν καθορίζεται μόνο από τον τύπο της, αλλά και από το συγκεκριμένο ευαίσθητο στην ασφάλεια πλαίσιο στο οποίο εμφανίζεται, μετατρέποντας έναν γενικό "υψηλό" κίνδυνο σε άμεση απειλή για την αυθεντικοποίηση και την ακεραιότητα της συνεδρίας.

#### 3. Έλλειψη Ελέγχου Υπογραφής JWT

*   **Όνομα Ευπάθειας:** Έλλειψη Ελέγχου Υπογραφής JWT
*   **Επηρρεαζόμενο Αρχείο/Τοποθεσία:**
    *   `src/main/java/org/owasp/webgoat/lessons/jwt/TokenTest.java:39`
    *   `src/main/java/org/owasp/webgoat/lessons/jwt/TokenTest.java:37`
*   **Περιγραφή:**
    Ένα JSON Web Token (JWT) είναι ένας συμπαγής, ασφαλής για URL τρόπος αναπαράστασης ισχυρισμών μεταξύ δύο μερών. Η ακεραιότητα και η αυθεντικότητα ενός JWT διασφαλίζονται από την υπογραφή του. Μια ευπάθεια "Έλλειψη Ελέγχου Υπογραφής JWT" εμφανίζεται όταν μια εφαρμογή αποκωδικοποιεί ή επεξεργάζει ένα JWT χωρίς να επαληθεύει σωστά την υπογραφή του.[27, 28, 29]
    *   **Αντίκτυπος:** Χωρίς επαλήθευση υπογραφής, ένας επιτιθέμενος μπορεί να:
        *   **Παραποιήσει/Αλλοιώσει Token:** Τροποποιήσει το περιεχόμενο του token (π.χ., να αλλάξει ρόλους χρηστών, ισχυρισμούς) και στη συνέχεια να χρησιμοποιήσει το χειραγωγημένο token για να αποκτήσει μη εξουσιοδοτημένη πρόσβαση ή να αυξήσει τα προνόμια.[28, 29, 30]
        *   **Επιθέσεις Επανάληψης:** Επαναχρησιμοποιήσει υποκλαπέντα tokens για μη εξουσιοδοτημένες ενέργειες.[28]
        *   **Πλαστοπροσωπήσει Ταυτότητες:** Πλαστοπροσωπήσει νόμιμους χρήστες.[29]
        *   **Παρακάμψει Αυθεντικοποίηση/Εξουσιοδότηση:** Παρακάμψει τους ελέγχους ασφαλείας που βασίζονται στην ακεραιότητα του JWT.[30]
    Η βιβλιοθήκη `io.jsonwebtoken.jwt` είναι μία από τις πολλές βιβλιοθήκες που χρησιμοποιούνται για την εργασία με JWTs. Προσφέρει διαφορετικές μεθόδους για την ανάλυση tokens, όπως `parse`, `parseClaimsJws` και `parsePlaintextJws`. Οι δύο τελευταίες επαληθεύουν σωστά ότι το JWT είναι σωστά υπογεγραμμένο, υπολογίζοντας την υπογραφή του συνδυασμού κεφαλίδας και payload και συγκρίνοντας την τοπικά υπολογισμένη υπογραφή με το τμήμα υπογραφής του JWT. Ωστόσο, ο εντοπισμένος κώδικας ορίζει ένα κλειδί υπογραφής JWT, αλλά η υπογραφή δεν επαληθεύεται.
*   **Αναφορά CWE:**
    *   CWE-347: Improper Verification of Cryptographic Signature [5, 27, 28, 29]
    *   CWE-327: Use of a Broken or Risky Cryptographic Algorithm (σχετικό, για μηδενική υπογραφή) [30]
    *   OWASP A02:2021 - Cryptographic Failures [28, 29]
*   **Απόσπασμα Επηρρεαζόμενου Κώδικα:**
    *   Για `TokenTest.java:39`:
        ```java
        36     log.debug(token);
        37     Jwt jwt = Jwts.parser().setSigningKey("qwerty1234").parse(token);
        38     jwt = Jwts.parser()
        39          .setSigningKeyResolver(
        40                     new SigningKeyResolverAdapter() {
        41                         @Override
        42                         public byte resolveSigningKeyBytes(JwsHeader header, Claims claims) {
        43                             return TextCodec.BASE64.decode(key);
        44                         }
        45                     })
        46          .parse(token);
        ```
    *   Για `TokenTest.java:37`:
        ```java
        34  .signWith(io.jsonwebtoken.SignatureAlgorithm.HS512, key)
        35  .compact();
        36     log.debug(token);
        37     Jwt jwt = Jwts.parser().setSigningKey("qwerty1234").parse(token);
        ```
*   **Προτεινόμενη Αποκατάσταση:**
    *   **Πάντα να Επαληθεύετε την Υπογραφή:** Βεβαιωθείτε ότι όλα τα JWTs επαληθεύονται με έγκυρη υπογραφή πριν εμπιστευτείτε ή επεξεργαστείτε το περιεχόμενό τους. Χρησιμοποιήστε μεθόδους ειδικά σχεδιασμένες για επαλήθευση υπογραφής.[27, 28, 29] Για την Java, χρησιμοποιήστε `parseClaimsJws()` αντί για `parse()`.[28] Για την Go, χρησιμοποιήστε `jwt.ParseWithClaims()` με μια συνάρτηση κλειδιού.[27] Για την Python, βεβαιωθείτε ότι παρέχονται `key` και `algorithms` στο `jwt.decode()`.[29]
    *   **Αποφυγή Μη Επαληθευμένης Ανάλυσης:** Ποτέ μην χρησιμοποιείτε συναρτήσεις ή διαμορφώσεις που απενεργοποιούν ρητά την επαλήθευση υπογραφής (π.χ., `ParseUnverified`, `verify=False`) σε κώδικα παραγωγής.[27, 29]
    *   **Ασφαλής Διαχείριση Κλειδιών:** Βεβαιωθείτε ότι το μυστικό κλειδί που χρησιμοποιείται για την υπογραφή και την επαλήθευση είναι ισχυρό, διατηρείται εμπιστευτικό και ανανεώνεται τακτικά.
    *   **Επικύρωση Εισόδου & Παρακολούθηση:** Εφαρμόστε κατάλληλη επικύρωση εισόδου για τα JWTs και παρακολουθήστε για τυχόν μη εξουσιοδοτημένες προσβάσεις ή απόπειρες παραποίησης.[30]
*   **Προαιρετικά: Σενάριο Επαλήθευσης/Εκμετάλλευσης:**
    Εάν ο χρήστης κατάφερε να πλαστογραφήσει ένα JWT και να αποκτήσει μη εξουσιοδοτημένη πρόσβαση, θα πρέπει να συμπεριλάβει στιγμιότυπα οθόνης και μια λεπτομερή περιγραφή του πλαστογραφημένου token και του παρατηρούμενου αποτελέσματος.

Η παρουσία πολλαπλών πανομοιότυπων ευρημάτων "Missing JWT signature check" εντός του αρχείου `TokenTest.java` υποδηλώνει ένα θεμελιώδες πρόβλημα στον τρόπο χειρισμού ή δοκιμής των JWTs στην εφαρμογή, και όχι απλώς μεμονωμένα σφάλματα κωδικοποίησης. Αυτό υποδηλώνει μια ευρύτερη ανεπάρκεια στην προσέγγιση της εφαρμογής στην ασφάλεια των JWTs. Θα μπορούσε να σημαίνει ότι η ίδια η σουίτα δοκιμών δεν επιβάλλει την κατάλληλη επαλήθευση υπογραφής ή ότι η βασική λογική επεξεργασίας JWT εφαρμόζεται με μη ασφαλή τρόπο. Αυτό αναδεικνύει την ανάγκη για μια ολοκληρωμένη προσέγγιση "ασφάλεια από το σχεδιασμό" για τα JWTs, η οποία περιλαμβάνει την αναθεώρηση των δοκιμαστικών περιπτώσεων για να διασφαλιστεί ότι επικυρώνουν σωστά την ακεραιότητα των JWTs.
```